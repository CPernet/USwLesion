# Brain Tumour Validation Scheme

USwLesion validation. The algorithm segments tissues using spatial priors in template (MNI) space. What is required is to provide a template with tissue classes and a mask of the lesion that will be moved into MNI space, first using an affine transform.

## BRAT

The data we are using has been acquired from the Multimodal Brain Tumour Image Segmentation Benchmark (BRATS) challenge. This venture was organised in 2012/2013 to assess and compare state-of-the-art automated brain tumour segmentation methods, and involved application of twenty algorithms to a dataset of low- and high-grade glioma patients (with the tumours manually delineated by up to four human expert raters), as well as 65 simulated synthetic scans. The study indicated that different algorithms were particularly successful for specific tumour sub-regions, with the associated errors being comparable to human inter-rater variability. No single algorithm performed best for all sub-regions simultaneously, and fusing different algorithms was found to improve performance significantly.

### Creation of masks and comparison to ground truth

For each of the 30 patients, we create two rough masks of the tumour using the 3D fill tool in MRICROn (one is of regular size and the second overshoots). These are visually checked against the ground truth, with overlap metrics then computed to get an idea of overlap and distribution in the quality of the masks as well as volumes of tumours for masks and ground truth.

*_Overlap Metrics_*:

Modified Jaccard Index (mJ)- overlap ratio measure that calculates similarity between two masks (computed vs ground thruth), and is defined as the size of the intersection divided by the size of the union of the masks.  

Dice coefficient (Dice)- This is a semimetric version of the Jaccard index, defined as twice the intersection divided by the sum of the masks.

Mean Hausdorff distance (mHd)- mathematical construct to measure the 'closeness' of two sets of points that are subsets of a metric space, i.e. a surface distance measure (the contour of the masks).

Matthews correlation coefficient (overlap.mcc) - MCC has a range from -1 to 1, where -1 indicates a completely incorrect binary classifier whereas 1 indicates a completely correct binary classifier. MCC takes into account true and false positives and negatives.

Cohen's Kappa coefficient (overlap.CK) - measures inter-rater agreement for categorical items.



#### Running segmentation routine

The segmentation routine is called in order to obtain the new lesion masks:  
- We start with two lesion masks of each patient, either smaller than ground truth or larger.  
- the segmentation routine runs with a variation of input parameter combinations: number of Gaussians (2, 3 or non parametric). the number of tissues that can be classified as 'affected' (i.e. GM+WM or GM+WM+CSF)
- from the mask outputs, different thresholding of the probabilistic lesion mask are performed: similarity to the ground truth is computed with binary masks defined as 1. probability of lesion being higher than 50%, 2. higher than 99%, 3. higher than the probability of any other tissue, 4. higher than the probability of each of the other tissues, 5. higher than the probability of the other tissues combined.  

This means that for each patient there will be 60 different lesion masks generated following application of the segmentation routine (12 parameter combinations multiplied by 5 thresholding methods).

##### Computing similarity of new lesion masks to the ground truth

For each of the new lesion masks, the similarity to the ground truth data is once again computed using the same overlap metrics as before.

###### Statistically testing which combination of parameters/thresholding method gives the best match to ground truth

The purpose of running stats on the data is to identify which of the 60 possible parameter combinations applied during segmentation generates a lesion mask that is best-matched to the ground truth.
The independant variable is the parameter combination (60 possibilities) and the dependant variables are the 5 measures of similarity (change from pre- to post-segmentation; mJ, mHd, mcc, kappa, Dice).

The MANOVA (multivariate analysis of variance) can be used when comparing two or more continuous response variables by a single factor; this is therefore an appropriate statistical test to detect differences in the average values of the dependent variables between the different levels of the independent variable.
The MANOVA test can also detect differences in correlations among the dependent variables between the different levels of the independent variable. A MANOVA analysis generates a p value that is used to determine whether or not the null hypothesis can be rejected.

Using the MANOVA, we can determine whether one parameter combination yields a change in mean similarity scores that is significantly different from the average of the other parameter combinations OR whether one parameter combination yields a change in mean similarity scores that is significantly different from another specific parameter combination OR the differences in correlation between the change in similarity scores.

Identifying how the average similarity scores differ between parameter combinations, we will be able to rank the parameter combinations in order of the greatest to least effect on change in similarity.
We could then check whether the change in different similarity scores for specific parameter combinations are correlated or not.
Assuming that each parameter combination generates a lesion mask that is more similar to ground truth than the mask pre-segmentation, this process will identify the exact combination that gives the best results.

If we wanted to test for differences in the means of any one of the similarity measures across the different levels of the independant variable, we could use a one-way ANOVA.

If we wanted to test the effect of each independant variable (number of gaussians for the lesion, number of affected tissues, VOI size, thresholding method) on the change in similarity, we could use a multivariate multiple linear regression. 
